#########################################
# Change prefix (C-b default) to C-g
# doesn't interfere with emacs-style editing keys

unbind -n C-b
unbind -n C-g
set -g prefix C-g

# C-g C-g to passthrough a C-g
unbind C-g
bind C-g send-key C-g

#########################################
# General options

# utf-8 everywhere
set -g utf8 on
set -g status-utf8 on

# quicker window refresh
set-option -g status-interval 5

# make windows behave better 
set-window-option -g aggressive-resize on
set-window-option -g automatic-rename on
set-window-option -g monitor-activity on

# nuke the annoying escape key delays
set -sg escape-time 5
set -g assume-paste-time 0

# 256 color all the way
set -g default-terminal "screen-256color"

# pass through xterm keys
set -g xterm-keys on

# bigger scrollback
set-option -g history-limit 10000

# sane window start
set -g base-index 1

# pass through focus events 
set-option -g focus-events on

#########################################
# General Keymap 

# redraw the client
bind R refresh-client

# reload tmux config
unbind r
bind r \
    source-file ~/.tmux.conf \;\
    display 'Reloaded tmux config.'

# user vi keybindings in copy-paste mode
set-window-option -g mode-keys vi

# use emacs keybindings for tmux cmd
set-option -g status-keys emacs

#########################################
# Window Management 

bind-key C-h previous-window
bind-key C-l next-window

# C-\ (no prefix) to skip to the last window we were in before this one
bind -n "C-\\" last-window

# C-Space (no prefix) to tab to the next window
bind -n C-Space next-window

########################################
# Pane Management

# easily toggle synchronization (mnemonic: e is for echo)
# sends input to all panes in a given window.
bind e setw synchronize-panes on
bind E setw synchronize-panes off

########################################
# Scrollback / pastebuffer

# Vim-style copy/paste
bind -t vi-copy v begin-selection

# copy-paste plugins
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'

#unbind [
#bind y copy mode
#unbind p
#bind p paste-buffer
#bind -t vi-copy y copy-selection
#bind -t vi-copy Escape cancel

###########################################################################
# Mouse mode is on by default.
# <prefix> M -- to turn it off
# <prefix> m -- to turn it on
#
# It's /really/ obvious that I'm cribbing this dotfiles repo right
# now: https://github.com/tangledhelix/dotfiles/blob/master/tmux.conf
#

if-shell '[[ $(echo "$(tmux -V | cut -d" " -f2) >= 2.1" | bc) -eq 1 ]]' \
    'set -g mouse on; bind m set -g mouse on \; display "Mouse ON"; bind M set -g mouse off \; display "Mouse OFF"' \
    'set -g mode-mouse on; set -g mouse-resize-pane on; set -g mouse-select-pane on; set -g mouse-select-window on; bind m set -g mode-mouse on \; set -g mouse-resize-pane on \; set -g mouse-select-pane on \; set -g mouse-select-window on \; display "Mouse ON"; bind M set -g mode-mouse off \; set -g mouse-resize-pane off \; set -g mouse-select-pane off \; set -g mouse-select-window off \; display "Mouse OFF"'

############################
# General Appearance

set -g status-left " #{?pane_in_mode,TMUX,TERM} "
set -g status-left-style bg=colour04,fg=black
#set -g status-left-length 50
set -g status-right " #T "
#set -g status-right-length 50
set -g status-right-style bg=colour04,fg=black

############################
# Theme: Base16 Eighties
#

# default statusbar setup 
set  -g status-style bg=colour18,fg=colour15
setw -g window-status-format " #I #W#[fg=colour8]#F "
setw -g window-status-separator ""

# default window title colors 
setw -g window-status-current-format " #I #W#[fg=colour11]#F "
setw -g window-status-current-style bg=colour19,fg=colour2

# messaging
set-option -g message-style bg=colour19,fg=colour2

# window activity monitor, bell monitor
setw -g window-status-activity-style bg=colour18,fg=colour15
setw -g window-status-bell-style bg=colour18,fg=colour15
 
############################
# Plugin Load 
set -g @plugin 'tmux-plugins/tpm'
run '~/.tmux/plugins/tpm/tpm'
